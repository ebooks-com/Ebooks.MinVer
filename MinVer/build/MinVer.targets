<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <MinVerBuildMetadata Condition=" '$(MinVerBuildMetadata)' == '' ">$(MINVER_BUILD_METADATA)</MinVerBuildMetadata>
    <MinVerMinimumMajorMinor Condition=" '$(MinVerMinimumMajorMinor)' == '' ">$(MINVER_MINIMUM_MAJOR_MINOR)</MinVerMinimumMajorMinor>
    <MinVerMinimumMajorMinor Condition=" '$(MinVerMinimumMajorMinor)' == '' ">0.0</MinVerMinimumMajorMinor>
    <MinVerTagPrefix Condition=" '$(MinVerTagPrefix)' == '' ">$(MINVER_TAG_PREFIX)</MinVerTagPrefix>
    <MinVerVerbose Condition=" '$(MinVerVerbose)' == '' ">$(MINVER_VERBOSE)</MinVerVerbose>
    <MinVerVerbose Condition=" '$(MinVerVerbose)' == '' ">false</MinVerVerbose>
    <MinVerVersion Condition=" '$(MinVerVersion)' == '' ">$(MINVER_VERSION)</MinVerVersion>
  </PropertyGroup>

  <PropertyGroup>
    <MSBuildAllProjects Condition="'$(MSBuildAssemblyVersion)' == '' Or '$(MSBuildAssemblyVersion)' &lt; '16.0'">$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    <GetPackageVersionDependsOn>$(GetPackageVersionDependsOn);MinVer</GetPackageVersionDependsOn>
  </PropertyGroup>

  <Target Name="MinVer_GetVersion" Condition=" '$(MinVerVersion)' == '' ">
    <Error Condition="'$(MinVerVerbose)' != 'true' And '$(MinVerVerbose)' != 'false'" Code="MINVER0003" Text="MinVerVerbose/MINVER_VERBOSE value '$(MinVerVerbose)' cannot be converted to a Boolean value." />
    <PropertyGroup>
      <MinVerVerboseOption Condition="'$(MinVerVerbose)' == 'true'"> --verbose</MinVerVerboseOption>
    </PropertyGroup>
    <Exec Command="dotnet &quot;$(MSBuildThisFileDirectory)../tools/MinVer.Cli.dll&quot; --path &quot;$(MSBuildProjectDirectory)&quot; --minimum-major-minor &quot;$(MinVerMinimumMajorMinor)&quot; --tag-prefix &quot;$(MinVerTagPrefix)&quot;$(MinVerVerboseOption)" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" ItemName="MinVerConsoleOutputItems" />
    </Exec>
    <ItemGroup>
      <MinVerConsoleOutputVersion Include="@(MinVerConsoleOutputItems)" Condition="'$([System.String]::new(`%(Identity)`).StartsWith(`MinVer:`))' != 'true'" />
    </ItemGroup>
    <PropertyGroup>
      <MinVerVersion>@(MinVerConsoleOutputVersion)</MinVerVersion>
    </PropertyGroup>
  </Target>

  <Target Name="MinVer" BeforeTargets="CoreCompile;GenerateNuspec" DependsOnTargets="MinVer_GetVersion" Condition="'$(UsingMicrosoftNETSdk)' == 'true' And '$(DesignTimeBuild)' != 'true'">
    <PropertyGroup>
      <MinVerVersion Condition=" '$(MinVerBuildMetadata)' != '' ">$(MinVerVersion)+$(MinVerBuildMetadata)</MinVerVersion>
      <Version>$(MinVerVersion)</Version>
      <PackageVersion>$(MinVerVersion)</PackageVersion>
    </PropertyGroup>
  </Target>

  <Target Name="MinVer_Warnings" BeforeTargets="MinVer" Condition="'$(DesignTimeBuild)' != 'true'">
    <Error Condition="'$(UsingMicrosoftNETSdk)' != 'true'" Code="MINVER0002" Text="MinVer only works in SDK-style projects." />
  </Target>

</Project>
